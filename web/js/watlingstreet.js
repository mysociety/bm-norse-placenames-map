(function($, google, _, mySociety){

    var watlingStreetCoordinates = [
        [-2.6418685913085938,52.6824183665388],
        [-2.6265907287597656,52.68116954828157],
        [-2.5927734375,52.68959837859999],
        [-2.5785255432128906,52.6946965109301],
        [-2.5615310668945312,52.69199145362352],
        [-2.5412750244140625,52.69219954090531],
        [-2.4962997436523438,52.69604897673206],
        [-2.4763870239257812,52.69563283787114],
        [-2.45269775390625,52.694904585319186],
        [-2.4214553833007812,52.69459247336368],
        [-2.305755615234375,52.69552880253609],
        [-2.246532440185547,52.69396824275837],
        [-2.1522903442382812,52.69407228181244],
        [-2.1316909790039062,52.69355208406283],
        [-2.103710174560547,52.68907812754314],
        [-2.0499801635742188,52.679816621541825],
        [-2.0233726501464844,52.67273909106213],
        [-1.9562530517578125,52.65628981316536],
        [-1.8589210510253906,52.65608155477594],
        [-1.8033027648925781,52.6393134997967],
        [-1.7682838439941406,52.6275407762601],
        [-1.7411613464355469,52.62253901473309],
        [-1.6482925415039062,52.6048198451001],
        [-1.6228866577148438,52.599815487190945],
        [-1.5567970275878906,52.58041819963589],
        [-1.5274429321289062,52.57175965005527],
        [-1.4613533020019531,52.55214119018524],
        [-1.4198112487792969,52.536795111284036],
        [-1.3600730895996094,52.51402710160183],
        [-1.3125228881835938,52.49678658634651],
        [-1.3027381896972656,52.49344218834781],
        [-1.2517547607421875,52.449837244068526],
        [-1.2242889404296875,52.421580780187575],
        [-1.1865234375,52.3779046344369],
        [-1.1360549926757812,52.317503874243215],
        [-1.1101341247558594,52.28139182920955],
        [-1.0828399658203125,52.243883941202306],
        [-1.0576057434082031,52.21875588648725],
        [-0.9968376159667969,52.13970442844444],
        [-0.984649658203125,52.12874614496163],
        [-0.872039794921875,52.067161091112524],
        [-0.8394241333007812,52.049851364907546],
        [-0.7765960693359375,52.0222897358207],
        [-0.6998634338378906,51.991962886131944],
        [-0.6693077087402344,51.980333906646976],
        [-0.6081962585449219,51.94384160969976],
        [-0.5510330200195312,51.906790076803965],
        [-0.49472808837890625,51.86938997466717],
        [-0.4615974426269531,51.83726251206912],
        [-0.4495811462402344,51.83057966411965],
        [-0.4179954528808594,51.82039436967609],
        [-0.4032325744628906,51.809251566800235],
        [-0.3719902038574219,51.7681585838171],
        [-0.3534507751464844,51.7572153832295],
        [-0.3404045104980469,51.751264568806576],
        [-0.3428077697753906,51.74648209613244],
        [-0.34915924072265625,51.74201799811856],
        [-0.33336639404296875,51.71437328746082],
        [-0.3096771240234375,51.670000116998196],
        [-0.2974891662597656,51.64817001698379],
        [-0.3050422668457031,51.63485381889416],
        [-0.2827262878417969,51.613219980429974],
        [-0.23260116577148438,51.571095013330975],
        [-0.17663955688476562,51.524552215462975],
        [-0.15466690063476562,51.508528775862885],
        [-0.14265060424804688,51.4957059653807],
        [-0.12239456176757812,51.48576580549173],
        [-0.10934829711914062,51.48084836613703],
        [-0.0460052490234375,51.474540439419755],
        [0.001201629638671875,51.471867325973555],
        [0.008068084716796875,51.47293659014834],
        [0.014591217041015625,51.4741127517942],
        [0.0295257568359375,51.47518196333959],
        [0.0679779052734375,51.46887325295412],
        [0.13475418090820312,51.45785765060893],
        [0.18093109130859375,51.45026282308676],
        [0.2961158752441406,51.43046754788038],
        [0.32306671142578125,51.430253498026275],
        [0.3465843200683594,51.419121523698344],
        [0.3874397277832031,51.407344369043386],
        [0.4142189025878906,51.40091918770499],
        [0.4698371887207031,51.398241762382725],
        [0.495758056640625,51.39556418033134],
        [0.5084609985351562,51.386352101119385],
        [0.5076026916503906,51.383459554141474],
        [0.5302619934082031,51.37928110795341],
        [0.5458831787109375,51.3748879711544],
        [0.5772972106933594,51.36920841344186],
        [0.6902503967285156,51.34798421013378],
        [0.7287025451660156,51.34080005576939],
        [0.7793426513671875,51.33264950245698],
        [0.8358192443847656,51.318918979022044],
        [0.92559814453125,51.30164271735329],
        [0.9949493408203125,51.28972796594161],
        [1.0296249389648438,51.28446731707717],
        [1.0768318176269531,51.28038721531609],
        [1.1116790771484375,51.25654358714669],
        [1.1446380615234375,51.23096775701038],
        [1.1868667602539062,51.192577342767365],
        [1.2165641784667969,51.17439256616892],
        [1.2316703796386719,51.16298306872396],
        [1.2469482421875,51.16244481516895],
        [1.2641143798828125,51.15340121633834],
        [1.2778472900390625,51.147263478942826],
        [1.2957000732421875,51.13735523330229],
        [1.3135528564453125,51.123135339885806]
    ];

    // Create a Path suitable for creating a google.maps.Polyline from an
    // array of coordinates in the Lon,Lat format Google's KML exports them
    var createWatlingStreetPath = function(coordinates) {
        var path = [];
        _.each(coordinates, function(coordinate) {
            path.push(new google.maps.LatLng(coordinate[1], coordinate[0]));
        });
        return path;
    };

    $(function() {
        var $map = $('#map-canvas');
        // Create watling street
        var watlingStreet = new google.maps.Polyline({
            path: createWatlingStreetPath(watlingStreetCoordinates),
            geodesic: true,
            strokeColor: '#111111',
            strokeOpacity: 1,
            strokeWeight: 4
        });
        var markerInfoTemplate = _.template($('script#watlingStreetMarkerInfo').html());
        var markerInfo = markerInfoTemplate();
        // Create an infowindow to show details in
        var infoWindow = new google.maps.InfoWindow({
            content: markerInfo,
            maxWidth: Math.round($map.innerWidth() * 0.65)
        });
        google.maps.event.addListener(watlingStreet, 'click', function(e) {
            infoWindow.setPosition(e.latLng);
            infoWindow.open(mySociety.map);
        });

        // Export Watling Street
        mySociety.watlingStreet = watlingStreet;
    });

})(window.jQuery, window.google, window._, window.mySociety);
